<ng-container *ngIf="scope$ | async">

  <div class="staff-dialog">

    <!-- Dialog Header -->
    <div class="staff-dialog-header">
      <div class="d-flex align-items-center gap-3 flex-fill">
        <div class="staff-dialog-icon">
          <i class="fa-solid fa-user-plus"></i>
        </div>
        <div class="flex-fill">
          <h2 class="staff-dialog-title">Add New Staff</h2>
          <p class="staff-dialog-subtitle">Fill in the details to create a new staff member</p>
        </div>
      </div>
      <button (click)="onClose()" class="staff-dialog-close" type="button" aria-label="Close dialog">
        <i class="fa-solid fa-xmark"></i>
      </button>
    </div>

    <!-- Dialog Body -->
    <div class="staff-dialog-body">
      <form [formGroup]="form">
        <div class="form-grid">

          <!-- Full Name -->
          <div class="form-field">
            <label class="field-label">
              <i class="fas fa-user"></i>
              Full Name <span class="required-star">*</span>
            </label>
            <input
              type="text"
              class="field-input"
              [class.invalid]="form.get('name')?.invalid && form.get('name')?.touched"
              formControlName="name"
              placeholder="Enter full name"
            />
            <span class="field-error" *ngIf="form.get('name')?.invalid && form.get('name')?.touched">
              <span *ngIf="form.get('name')?.errors?.['required']">Name is required</span>
              <span *ngIf="form.get('name')?.errors?.['minlength']">Minimum 3 characters</span>
            </span>
          </div>

          <!-- SSN -->
          <div class="form-field">
            <label class="field-label">
              <i class="fas fa-hashtag"></i>
              SSN <span class="required-star">*</span>
            </label>
            <input
              type="text"
              class="field-input"
              [class.invalid]="form.get('ssn')?.invalid && form.get('ssn')?.touched"
              formControlName="ssn"
              placeholder="Enter 14-digit national ID"
              maxlength="14"
            />
            <span class="field-error" *ngIf="form.get('ssn')?.invalid && form.get('ssn')?.touched">
              <span *ngIf="form.get('ssn')?.errors?.['required']">SSN is required</span>
            </span>
          </div>

          <!-- Email -->
          <div class="form-field">
            <label class="field-label">
              <i class="fas fa-envelope"></i>
              Email Address <span class="required-star">*</span>
            </label>
            <input
              type="email"
              class="field-input"
              [class.invalid]="form.get('email')?.invalid && form.get('email')?.touched"
              formControlName="email"
              placeholder="example@university.edu"
            />
            <span class="field-error" *ngIf="form.get('email')?.invalid && form.get('email')?.touched">
              <span *ngIf="form.get('email')?.errors?.['required']">Email is required</span>
              <span *ngIf="form.get('email')?.errors?.['email']">Enter a valid email</span>
            </span>
          </div>

          <!-- Password -->
          <div class="form-field">
            <label class="field-label">
              <i class="fas fa-lock"></i>
              Password <span class="required-star">*</span>
            </label>
            <div class="input-wrapper">
              <input
                [type]="showPassword ? 'text' : 'password'"
                class="field-input"
                [class.invalid]="form.get('password')?.invalid && form.get('password')?.touched"
                formControlName="password"
                placeholder="Enter password"
              />
              <button
                type="button"
                class="toggle-password"
                (click)="showPassword = !showPassword"
                tabindex="-1"
              >
                <i class="fa-solid" [ngClass]="showPassword ? 'fa-eye-slash' : 'fa-eye'"></i>
              </button>
            </div>
            <span class="field-error" *ngIf="form.get('password')?.invalid && form.get('password')?.touched">
              <span *ngIf="form.get('password')?.errors?.['required']">Password is required</span>
              <span *ngIf="form.get('password')?.errors?.['minlength']">Minimum 6 characters</span>
            </span>
          </div>

          <!-- Roles -->
          <div class="form-field">
            <label class="field-label">
              <i class="fas fa-shield-alt"></i>
              Roles <span class="required-star">*</span>
            </label>

            <ng-select
              [items]="availableRoles"
              bindLabel="name"
              bindValue="name"
              [multiple]="true"
              [closeOnSelect]="false"
              [searchable]="true"
              [clearable]="true"
              placeholder="Select roles..."
              formControlName="roles"
              class="roles-select"
              [class.invalid]="form.get('roles')?.invalid && form.get('roles')?.touched"
              [class.has-value]="getSelectedRoles().length > 0"
              notFoundText="No roles found"
              loadingText="Loading roles..."
            >
              <ng-template ng-option-tmp let-item="item" let-item$="item$">
                <div class="role-option">
                  <span class="role-checkbox">
                    <i class="fas fa-check" *ngIf="item$.selected"></i>
                  </span>
                  <span class="role-name">{{ item.name }}</span>
                </div>
              </ng-template>

              <ng-template ng-multi-label-tmp let-items="items" let-clear="clear">
                <div class="role-tag" *ngFor="let item of items">
                  {{ item.name }}
                  <span class="remove-tag" (click)="clear(item.name)">Ã—</span>
                </div>
              </ng-template>
            </ng-select>

            <span class="field-error" *ngIf="form.get('roles')?.invalid && form.get('roles')?.touched">
              Please select at least one role
            </span>
          </div>

          <!-- Account Status -->
          <div class="form-field">
            <label class="field-label">
              <i class="fas fa-toggle-on"></i>
              Account Status
            </label>
            <div
              class="status-box"
              [class.active]="!form.get('isDisabled')?.value"
              [class.inactive]="form.get('isDisabled')?.value"
            >
              <div class="status-info">
                <span
                  class="status-indicator"
                  [class.off]="form.get('isDisabled')?.value"
                ></span>
                <div>
                  <div class="status-label">
                    {{ form.get('isDisabled')?.value ? 'Disabled' : 'Active' }}
                  </div>
                  <div class="status-desc">
                    {{ form.get('isDisabled')?.value ? 'This account is currently suspended' : 'This account is fully operational' }}
                  </div>
                </div>
              </div>
              <label class="switch">
                <input type="checkbox" formControlName="isDisabled">
                <span class="slider"></span>
              </label>
            </div>
          </div>

        </div>
      </form>
    </div>

    <!-- Dialog Footer -->
    <div class="staff-dialog-footer">
      <button (click)="onClose()" type="button" class="btn btn-cancel">
        Cancel
      </button>
      <button type="button" class="btn btn-submit" [disabled]="form.invalid" (click)="onSubmit()">
        <i class="fa-solid fa-plus"></i>
        <span>Create Staff</span>
      </button>
    </div>

  </div>

</ng-container>
