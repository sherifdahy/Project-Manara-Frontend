<ng-container *ngIf="(staffs$ | async) as response">
  <div class="container-fluid px-0">

    <!-- Staff Section -->
    <div class="staffs-section">
      <div class="section-card">

        <!-- Section Header -->
        <div class="section-header">
          <div>
            <h4 class="section-title">All Staff Members</h4>
            <p class="section-subtitle">Manage and view all staff accounts</p>
          </div>

          <div class="header-actions">
            <!-- Search -->
            <div class="search-bar-wrapper">
              <div class="search-bar">
                <i class="fa-solid fa-magnifying-glass search-icon"></i>
                <input type="text" class="search-input" placeholder="Search by name, email, phone, SSN..."
                  [(ngModel)]="filters.SearchValue" (change)="onSearch()" />
              </div>
            </div>

            <!-- Status Filter -->
            <div class="filter-dropdown-container">
              <div class="custom-select-wrapper">
                <select class="custom-select" [(ngModel)]="selectedStatus" (ngModelChange)="onStatusFilter()">
                  <option [value]="false">Active Only</option>
                  <option [value]="true">All</option>
                </select>
                <i class="fa-solid fa-chevron-down select-icon"></i>
              </div>
            </div>

            <button class="btn-add-staff" (click)="onAddStaff()">
              <i class="fa-solid fa-plus"></i>
              <span>Add Staff</span>
            </button>
          </div>
        </div>

        <!-- Staff Table -->
        <div class="data-table-wrapper">
          <table class="data-table">
            <thead>
              <tr>
                <th>Staff Member</th>
                <th>Email</th>
                <th>Phone</th>
                <th>SSN</th>
                <th>Roles</th>
                <th>Status</th>
                <th class="text-center">Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let staff of response.items">
                <td>
                  <div class="table-cell-with-icon">
                    <a [routerLink]="[staff.id]" class="table-cell-content">
                      <span class="table-cell-title">{{ staff.name }}</span>
                    </a>
                  </div>
                </td>
                <td><span class="staff-email">{{ staff.email }}</span></td>
                <td><span class="staff-phone">{{ staff.phone || '—' }}</span></td>
                <td><span class="staff-ssn">{{ staff.ssn }}</span></td>
                <td>
                  <div class="roles-list">
                    <span class="table-value-badge" *ngFor="let role of staff.roles">
                      {{ role }}
                    </span>
                    <span *ngIf="!staff.roles || staff.roles.length === 0">—</span>
                  </div>
                </td>
                <td>
                  <span class="table-status-badge status-deleted" *ngIf="staff.isDeleted">Deleted</span>
                  <span class="table-status-badge status-active" *ngIf="!staff.isDeleted">Active</span>
                </td>
                <td>
                  <div class="table-actions">
                    <a [routerLink]="[staff.id]" class="table-action-btn btn-primary" title="Edit Staff">
                      <i class="fa-solid fa-pen"></i>
                    </a>
                    <button class="table-action-btn btn-danger" title="Delete Staff" (click)="onDelete(staff)">
                      <i class="fa-solid fa-trash"></i>
                    </button>
                  </div>
                </td>
              </tr>

              <!-- Empty State -->
              <tr *ngIf="response.items.length === 0">
                <td colspan="7">
                  <div class="table-empty-state">
                    <div class="table-empty-icon">
                      <i class="fa-solid fa-user-slash"></i>
                    </div>
                    <h3 class="table-empty-title">No Staff Found</h3>
                    <p class="table-empty-text">
                      There are no staff members matching your criteria.
                    </p>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- ✅ Pagination - ظاهر دايماً لو فيه data -->
        <div class="table-pagination" *ngIf="response.items.length > 0">

          <!-- Left: Info + Page Size -->
          <div class="pagination-left">
            <div class="table-pagination-info">
              Showing {{ getStartIndex(response) }} to {{ getEndIndex(response) }}
              of {{ response.totalCount }} staff members
            </div>

            <!-- Page Size Dropdown -->
            <div class="page-size-wrapper">
              <span class="page-size-label">Rows per page:</span>
              <div class="custom-select-wrapper page-size-select">
                <select class="custom-select" [(ngModel)]="filters.PageSize" (change)="onPageSizeChange()">
                  <option *ngFor="let size of pageSizeOptions" [ngValue]="size">
                    {{ size }}
                  </option>
                </select>
                <i class="fa-solid fa-chevron-down select-icon"></i>
              </div>
            </div>
          </div>

          <!-- Right: Page Controls -->
          <div class="table-pagination-controls">
            <!-- First Page -->
            <button class="table-pagination-btn" [disabled]="!response.hasPreviousPage"
              (click)="goToPage(1, response.totalPages)" title="First Page">
              <i class="fa-solid fa-angles-left"></i>
            </button>

            <!-- Previous -->
            <button class="table-pagination-btn" [disabled]="!response.hasPreviousPage"
              (click)="goToPage(filters.PageNumber - 1, response.totalPages)" title="Previous Page">
              <i class="fa-solid fa-chevron-left"></i>
            </button>

            <!-- Page Numbers -->
            <button *ngFor="let page of getPages(response.totalPages)" class="table-pagination-btn"
              [class.active]="page === filters.PageNumber" (click)="goToPage(page, response.totalPages)">
              {{ page }}
            </button>

            <!-- Next -->
            <button class="table-pagination-btn" [disabled]="!response.hasNextPage"
              (click)="goToPage(filters.PageNumber + 1, response.totalPages)" title="Next Page">
              <i class="fa-solid fa-chevron-right"></i>
            </button>

            <!-- Last Page -->
            <button class="table-pagination-btn" [disabled]="!response.hasNextPage"
              (click)="goToPage(response.totalPages, response.totalPages)" title="Last Page">
              <i class="fa-solid fa-angles-right"></i>
            </button>
          </div>
        </div>

      </div>
    </div>
  </div>
</ng-container>
